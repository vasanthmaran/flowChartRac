<html>

<head>
    
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script type="text/javascript" src="https://static.facilio.com/apps-sdk/latest/facilio_apps_sdk.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/dist/echarts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.0/theme/dark.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <div id="app" v-loading="loading" style="padding: 20px;">
        <div id="chart" width="100%" height="80%"></div>
        <div style="overflow: auto;">   
            <el-table 
            :data="tableData"
            stripe 
            row-key="id"
            @current-change="handleCurrentChange"
            height="500"
            style="width: 100%;text-align: center;">
                <el-table-column>
                </el-table-column>
                <el-table-column label="Name" prop="ruleName" sortable  width="600px"> </el-table-column>
                <el-table-column label="Category" width="200px" prop="assetCategoy" style="text-align: center;"> </el-table-column>
                <el-table-column label="Type" prop="faultType" width="200px" style="text-align: center;"> </el-table-column>
                <el-table-column label="Duration" prop="duration" width="200px" sortable style="text-align: center;"> </el-table-column>
                <el-table-column label="Action"  style="text-align: center;" >
                    <template slot-scope="props">
                        <el-link style="color: #409eff;"  :href="props.row.url" target="_blank">More</el-link>
                    </template>
                 </el-table-column>
            </el-table>
        </div>
    </div>
</body>
<script type="text/javascript">
    var app = new Vue({
        el: '#app',
        data() {
            return {
                loading: true,
                tableData: [],
                options: {}
            }
        },
        mounted() {
            
            this.chartFuntion()
            this.funtionSample()
            // next tick
        },
        methods: {
           
            handleCurrentChange(val) {
                console.log(val.data)
                
                if (val.data != "") {
                    this.chartFuntion(val.data)
                }
                
            },
            tableRowClassName({row, rowIndex}) {
                if (rowIndex === 1) {
                return 'warning-row';
                } else if (rowIndex === 3) {
                return 'success-row';
                }
                return '';
            },
            funtionSample () {
                this.tableData = [
    {
      "duration": "07 Hrs ",
      "resourceId": [
        34062
      ],
      "data": [
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659416400000,
            1659419400000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659441600000,
            1659442200000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659442800000,
            1659459600000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659504000000,
            1659504600000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659524400000,
            1659525000000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659525600000,
            1659547200000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659589200000,
            1659591000000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659610200000,
            1659633600000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659702600000,
            1659719400000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659931200000,
            1659934200000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659951600000,
            1659978600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        }
      ],
      "children": [
        {
          "duration": "07 Hrs ",
          "ruleName": "FCU-2-7",
          "rule": 5597,
          "faultType": "Operational Fault",
          "assetCategoy": "FCU",
          "id": 11,
          "url": "https://app.facilio.co.uk/app/fa/faults/all/newsummary/5597?tab=summary"
        }
      ],
      "moduleName": "fcureturnairtemperaturesetpointviolationrcausecase",
      "rule": 230,
      "ruleName": "FCU Return air temperature setpoint violation",
      "assetCategoy": "FCU",
      "faultType": "Operational Fault",
      "id": 1,
      "url": "https://app.facilio.co.uk/app/fa/newrules/all/230/summary"
    },
    {
      "duration": 0,
      "moduleName": "rcareturnairtemperaturesensorerror",
      "rule": 232,
      "ruleName": "RCA: Return air temperature sensor error",
      "assetCategoy": "FCU",
      "resourceId": [
        34062
      ]
    },
    {
      "duration": 0,
      "moduleName": "rcareturnairtemperaturedatareliabilityerror",
      "rule": 233,
      "ruleName": "RCA: Return air temperature data reliability error",
      "assetCategoy": "FCU",
      "resourceId": [
        34062
      ]
    },
    {
      "duration": 0,
      "moduleName": "rcasupplyairtemperaturedatareliabilityerror",
      "rule": 234,
      "ruleName": "RCA: Supply air temperature data reliabiity error",
      "assetCategoy": "FCU",
      "resourceId": [
        34062
      ]
    },
    {
      "duration": 0,
      "moduleName": "rcachilledwatervalvecommanddatareliabilityerror",
      "rule": 235,
      "ruleName": "RCA: Chilled water valve command data reliability error",
      "assetCategoy": "FCU",
      "resourceId": [
        34062
      ]
    },
    {
      "duration": 0,
      "moduleName": "rcaheatingwatervalvecommanddatareliabilityerror",
      "rule": 236,
      "ruleName": "RCA: Heating water valve command data reliability error",
      "assetCategoy": "FCU",
      "resourceId": [
        34062
      ]
    },
    {
      "duration": "00 Hrs 20 Mins",
      "resourceId": [
        34062
      ],
      "data": [
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659416400000,
            1659419400000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659441600000,
            1659442200000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659442800000,
            1659459600000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659504000000,
            1659504600000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659524400000,
            1659525000000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659525600000,
            1659547200000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659589200000,
            1659591000000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659610200000,
            1659633600000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659702600000,
            1659719400000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659931200000,
            1659934200000
          ]
        },
        {
          "x": "FCU Return air temperature setpoint violation",
          "y": [
            1659951600000,
            1659978600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        },
        {
          "x": "RCA: Supply air temperature sensor error",
          "y": [
            1659699000000,
            1659699600000
          ]
        }
      ],
      "children": [
        {
          "duration": "00 Hrs 20 Mins",
          "ruleName": "FCU-2-7",
          "rule": 6357,
          "faultType": "Sensor Fault",
          "assetCategoy": "FCU",
          "id": 71,
          "url": "https://app.facilio.co.uk/app/fa/faults/all/newsummary/6357?tab=summary"
        }
      ],
      "moduleName": "rcasupplyairtemperaturesensorerror",
      "rule": 237,
      "ruleName": "RCA: Supply air temperature sensor error",
      "assetCategoy": "FCU",
      "faultType": "Sensor Fault",
      "id": 7,
      "url": "https://app.facilio.co.uk/app/fa/newrules/all/237/summary"
    }
  ]
                this.loading = false
            },
            chartFuntion (data) {
                console.log("Data: ", data)
                
                if (data == null) {
                    console.log("inside: ", data)
                    data = [
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659416400000,
                                    1659419400000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659441600000,
                                    1659442200000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659442800000,
                                    1659459600000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659504000000,
                                    1659504600000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659524400000,
                                    1659525000000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659525600000,
                                    1659547200000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659589200000,
                                    1659591000000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659610200000,
                                    1659633600000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659702600000,
                                    1659719400000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659931200000,
                                    1659934200000
                                ]
                                },
                                {
                                "x": "FCU Return air temperature setpoint violation",
                                "y": [
                                    1659951600000,
                                    1659978600000
                                ]
                                }
                            ]
                }
                    
                var options = {
                    chart: {
                        height: 300,
                        type: 'rangeBar'
                    },
                    series: [
                        {
                        data: data
                        }
                    ],
                    plotOptions: {
                        bar: {
                            horizontal: true,
                            barHeight: '20%'
                        }
                    },
                    xaxis: {
                        type: 'datetime',
                        labels: {
                            format: 'dd/MM/yyyy',
                        }
                    },
                    yaxis: {
                        
                        show: true,
                    },
                    grid: {
                        row: {
                            colors: ['#f3f4f5', '#fff'],
                            opacity: 1
                        }
                    },
                    tooltip: {
                        x: {
                            show: false,
                            format: 'dd/MM HH:mm',
                        }
                    },
                    dataLabels: {
                        textAnchor: 'start',
                        distributed: false,
                        offsetX: 0,
                        offsetY: 0,
                    },
                    stroke: {
                        width: 1
                        },
                        fill: {
                        type: 'solid',
                        opacity: 0.6
                        },
                    toolbar: {
                      show: false,
                    }
                }
                document.querySelector("#chart").innerHTML= ""
                var chart = new ApexCharts(document.querySelector("#chart"), options);
                chart.render();
            }
        }
    })
</script>
<style>
     body {
        font-family: 'aktiv-grotesk', sans-serif;
        -ms-text-size-adjust: 100%;
        -webkit-text-size-adjust: 100%;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-smoothing: antialiased;
        /* background: #EBECF0;
        color: #0c0c0c;
        margin: 0;
        padding: 0; */
    }

  * {
    font-family: 'aktiv-grotesk', sans-serif;
  }
    .el-table .warning-row {
        background: oldlace;
    }

    .el-table .success-row {
        background: #f0f9eb;
    }
    .el-table--enable-row-transition .el-table__body td {
        font-size: 13px;
        font-weight: normal;
        letter-spacing: .4px;
        color: #324056;
        border-bottom-width: thin;
    }
    .el-table {
    position: relative;
    overflow: hidden;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-box-flex: 1;
    -ms-flex: 1;
    flex: 1;
    width: 100%;
    max-width: 100%;
    font-size: 14px;
    color: #606266;
}

.el-table td.el-table__cell, .el-table th.el-table__cell.is-leaf {
    border-bottom: 1px solid #EBEEF5;
}
.el-table th.el-table__cell {
    overflow: hidden;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    background-color: #FFF;
}
.el-table th.is-leaf {
    padding-top: 10px;
    padding-bottom: 10px;
}
.el-table td, .el-table th.is-leaf {
     padding-left: 0px;
}
.contentBody {
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
    word-break: break-all;
    line-height: 23px;
    padding-left: 10px;
    padding-right: 10px;
}
.apexcharts-toolbar {
    /* display: none; */
}
</style>
</html>
